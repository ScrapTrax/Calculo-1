<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora de Derivadas - Método Largo</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    input, button { padding: 8px; margin-top: 10px; width: 100%; }
    .resultado { background: white; padding: 15px; margin-top: 20px; border-radius: 5px; }
    h1 { color: #333; }
</style>
</head>
<body>

<h1>Derivadas por el método del límite</h1>
<p>Escribe tu función f(x):</p>
<input type="text" id="funcion" placeholder="Ejemplo: x^2 + 3*x + 1">
<button onclick="calcular()">Calcular Derivada</button>

<div id="salida" class="resultado"></div>

<script>
function calcular() {
    let exprInput = document.getElementById("funcion").value.trim();
    if (!exprInput) {
        document.getElementById("salida").innerHTML = "<b>Error:</b> Ingresa una función.";
        return;
    }

    try {
        let f = math.parse(exprInput);
        let x = math.parse("x");
        let h = math.parse("h");

        // f(x+h)
        let f_xh = f.transform(function (node) {
            if (node.isSymbolNode && node.name === "x") {
                return math.parse("(x + h)");
            }
            return node;
        });

        // Paso 1: f(x+h) - f(x)
        let paso1 = new math.OperatorNode("-", "subtract", [f_xh, f]);
        // Paso 2: (f(x+h) - f(x)) / h
        let paso2 = new math.OperatorNode("/", "divide", [paso1, h]);
        // Paso 3: simplificar
        let simplificado = math.simplify(paso2);
        // Paso 4: límite cuando h→0
        let derivada = simplificado.evaluate({h: 0});

        document.getElementById("salida").innerHTML = `
            <b>Paso 1:</b> f(x+h) - f(x) = ${paso1.toString()}<br>
            <b>Paso 2:</b> Cociente de diferencias = ${paso2.toString()}<br>
            <b>Paso 3:</b> Simplificado = ${simplificado.toString()}<br>
            <b>Paso 4:</b> Límite h→0 = <b>${derivada}</b>
        `;
    } catch (err) {
        document.getElementById("salida").innerHTML = "<b>Error:</b> " + err.message;
    }
}
</script>

</body>
</html>
